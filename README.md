# fastaip_mongodb_project

# –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Fast API (Python).

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.

## –§—Ä–µ–π–º–≤–æ—Ä–∫ FAST API

<aside>
üî• –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [https://fastapi.tiangolo.com/](https://fastapi.tiangolo.com/)

</aside>

### –ß—Ç–æ —ç—Ç–æ?

[FastAPI](https://fastapi.tiangolo.com/) ‚Äî —ç—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–∞–∫–æ–Ω–∏—á–Ω—ã—Ö –∏ –¥–æ–≤–æ–ª—å–Ω–æ –±—ã—Å—Ç—Ä—ã—Ö HTTP API-—Å–µ—Ä–≤–µ—Ä–æ–≤ —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é, —á—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∏–∑ –∫–æ—Ä–æ–±–∫–∏. –°—Ç–æ–∏—Ç –æ–Ω –Ω–∞ –ø–ª–µ—á–∞—Ö –¥–≤—É—Ö –¥—Ä—É–≥–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤: —Ä–∞–±–æ—Ç–æ–π —Å web –≤ FastAPI –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è [Starlette](https://www.starlette.io/), –∞ –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—Ç–≤–µ—á–∞–µ—Ç [Pydantic](https://pydantic-docs.helpmanual.io/).

–î–ª—è —Ä–∞–±–æ—Ç—ã FastAPI –Ω–µ–æ–±—Ö–æ–¥–∏–º ASGI-—Å–µ—Ä–≤–µ—Ä, –ø–æ –¥–µ—Ñ–æ–ª—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç uvicorn, –±–∞–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ uvloop.

### –ß—Ç–æ —Ç–∞–∫–æ–µ ASGI-—Å–µ—Ä–≤–µ—Ä?

–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä.  –ù–∏–∂–µ —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–µ—Ä–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º. 

 –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –æ–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ Web-—Å–µ—Ä–≤–µ—Ä–∞, —ç—Ç–æ uvicorn(–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ Apache), –∫–æ—Ç–æ—Ä—ã–π –∂–¥–µ—Ç –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤, –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ Fast api - —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —ç—Ç–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. 

–¢–∞–∫–∂–µ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ –µ—Å—Ç—å –æ–±—ä–µ–∫—Ç—ã "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ" - —ç—Ç–æ python —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–∞–∑—ã–≤–∞—é—Ç endpoint, –æ –Ω–∏—Ö –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø–æ–∑–∂–µ. 

–î–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤–∑—è—Ç–∞ –∏–∑ —ç—Ç–æ–≥–æ [–≤–∏–¥–µ–æ](https://www.youtube.com/watch?v=6jxveKOdyNg), –±—É–¥–µ—Ç **–æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ** –µ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —Ö–æ—Ç—å –æ–Ω–æ –∏ –¥–ª—è Flask.

![Untitled](images/Untitled.png)

![Untitled](images/Untitled%201.png)

–ù–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —á—Ç–æ —Å –ø–æ–º–æ—â—å—é WSGI Web-—Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º. –ò–∑—É—á–∏–º, —á—Ç–æ —Ç–∞–∫–æ–µ WSGI.

> WSGI (–∞–Ω–≥–ª. Web Server Gateway Interface) ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É Python-–ø—Ä–æ–≥—Ä–∞–º–º–æ–π, –≤—ã–ø–æ–ª–Ω—è—é—â–µ–π—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞, –∏ —Å–∞–º–∏–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä Apache. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ - —Å–≤–æ–π –ø–æ—Ç–æ–∫.
> 

> ASGI (–∞–Ω–≥–ª. Asynchronous Server Gateway Interface) ‚Äî –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ WSGI. –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å WSGI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–∞–∫ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö, —Ç–∞–∫ –∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ WSGI –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
> 

–¢–æ –µ—Å—Ç—å ASGI –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç WSGI –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–º, –≤ –æ—Å—Ç–∞–ª—å–Ω–æ–º –æ–Ω–∏ –ø–æ—Ö–æ–∂–∏. –í —Ü–µ–ª–æ–º –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ –æ—Å–æ–±–æ –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å —á—Ç–æ —ç—Ç–æ, –Ω–æ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –∑–Ω–∞—Ç—å —Å—Ç–æ–∏—Ç. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å [—Ç—É—Ç](https://habr.com/ru/post/482936/).

–ù–∞–¥–µ—é—Å—å, —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–Ω–æ –ø–æ–Ω—è—Ç–Ω–µ–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ç–∫–µ–Ω–¥. 

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

<aside>
üìå [–¢—É—Ç–æ—Ä–∏–∞–ª](https://testdriven.io/blog/fastapi-mongo/), –∫–æ—Ç–æ—Ä—ã–π —è –ø–µ—Ä–µ–≤–æ–¥–∏–ª–∞.

</aside>

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

1. –î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è [PyCharm](https://www.jetbrains.com/pycharm/). –°–∫–∞—á–∞–π—Ç–µ –µ–≥–æ, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç Pure Python, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –≤—ã–±—Ä–∞–Ω.

![Untitled](images/Untitled%202.png)

### –°–æ–∑–¥–∞–¥–∏–º –¥–µ—Ä–µ–≤–æ –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ –¥–µ—Ä–µ–≤–æ –ø–∞–ø–æ–∫ –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ (server/models/car.py –º—ã –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ):

```
‚îú‚îÄ‚îÄ app
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ __init__.py
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ main.py
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ server
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ app.py
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ database.py
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ models
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ routes
‚îî‚îÄ‚îÄ requirements.txt
```

![Untitled](images/Untitled%203.png)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–í —Ñ–∞–π–ª–µ requirements.txt –∑–∞–ø–∏—à–∏—Ç–µ:

```markdown
fastapi==0.68.1
uvicorn==0.13.4
motor==2.5.1
python-decouple
```

–ó–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É: 

```
pip install -r requirements.txt
```

<aside>
üìå –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã pip —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ requirements.txt –≤ —Ñ–æ—Ä–º–µ '–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞'=='–≤–µ—Ä—Å–∏—è'. –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ –≤–µ—Ä—Å–∏—é,  —É–∫–∞–∂–∏—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ. –ü–æ–¥—Ä–æ–±–Ω–µ–µ [—Ç—É—Ç](https://pip.pypa.io/en/stable/user_guide/).

</aside>

### –ù–∞—á–Ω–µ–º –ø–∏—Å–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!

–í —Ñ–∞–π–ª–µ app/server/app.py –Ω–∞–ø–∏—à–∏—Ç–µ:

```python
fromfastapiimport FastAPI

app = FastAPI()

@app.get("/", tags=["Root"])
asyncdef read_root():
return {"message": "Welcome to this fantastic app!"}
```

–í —Ñ–∞–π–ª–µ  app/main.py –∑–∞–ø–∏—à–∏—Ç–µ:

```python
import uvicorn

if __name__ == "__main__":
    uvicorn.run("server.app:app", host="127.0.0.1", port=8000, reload=True)
```

–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?

–§–∞–π–ª app/main.py –±—É–¥–µ—Ç –Ω–∞—à–µ–π –≤—Ö–æ–¥–Ω–æ–π —Ç–æ—á–∫–æ–π - —Ç–µ–º —Ñ–∞–π–ª–æ–º, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞. –ó–¥–µ—Å—å –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ "server.app:app" –º—ã –∑–∞–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –≤ —Ñ–∞–π–ª–µ /server/app —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º app.

–ó–∞–ø—É—Å—Ç–∏–º –Ω–∞—à–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ PyCharm
    
    ```bash
     python app/main.py
    ```
    
- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PyCharm
    1. –ó–∞—Ö–æ–¥–∏–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞.
    
    ![Untitled](images/Untitled%204.png)
    
    1. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É main, –±–æ–ª—å—à–µ –º–µ–Ω—è—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–¥–æ
    
    ![Untitled](images/Untitled%205.png)
    

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –≤ –∫–æ–Ω—Å–æ–ª–µ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

![Untitled](images/Untitled%206.png)

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ –∏ –≤–∏–¥–∏–º JSON —Å—Ç—Ä–æ–∫—É 

![Untitled](images/Untitled%207.png)

–£—Ä–∞! –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

–ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –Ω–∞—á–Ω–µ–º –ø–∏—Å–∞—Ç—å route –∏ endpoints, —Å–æ—Å—Ç–∞–≤–∏–º —Å—Ö–µ–º—ã –¥–ª—è –±–¥.

### –°—Ö–µ–º–∞ –ë–î

–î–∞–≤–∞–π—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏–º [—Å—Ö–µ–º—É](https://pydantic-docs.helpmanual.io/usage/schema/), –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ MongoDB. 

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pydantic Schema –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ä—è–¥—É —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π(–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö) (JSON -> Python) –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π (Python -> JSON). –ù–æ! –æ–Ω –Ω–µ —Å–ª—É–∂–∏—Ç –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–º —Å—Ö–µ–º—ã Mongo.

<aside>
‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Pydantic: [https://pydantic-docs.helpmanual.io/usage/schema/](https://pydantic-docs.helpmanual.io/usage/schema/)

</aside>

–í –ø–∞–ø–∫–µ app/server/models —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª car.py, –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Å—Ö–µ–º–∞ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

```python
from typing import Optional

from pydantic import BaseModel, Field

class CarSchema(BaseModel):
    brand: str = Field(...)
    series: str = Field(...)
    color: str = Field(...)
    year_of_release: int = Field(...)

    class Config:
        schema_extra = {
            "example": {
                "brand": "BMW",
                "series": "M3",
                "color": "Blue",
                "year_of_release": "2016",
            }
        }

class UpdateCarModel(BaseModel):
    brand: Optional[str]
    series: Optional[str]
    color: Optional[str]
    year_of_release: Optional[int]

    class Config:
        schema_extra = {
            "example": {
                "brand": "BMW",
                "series": "M5",
                "color": "Yellow",
                "year_of_release": "2020",
            }
        }

def ResponseModel(data, message):
    return {
        "data": [data],
        "code": 200,
        "message": message,
    }

def ErrorResponseModel(error, code, message):
    return {"error": error, "code": code, "message": message}
```

CarSchema - –º–æ–¥–µ–ª—å, –∫–∞–∫ –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ–±—ä–µ–∫—Ç car –≤ –ë–î.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```python
brand: str = Field(...)
brand: str - –∑–∞–¥–∞–µ–º —Ç–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –µ—Å—Ç—å –º–Ω–æ–≥–æ —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –æ–Ω–∏ —É–∫–∞–∑–∞–Ω—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
Field(...) - –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —ç—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ 
–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å. 
```

class Config - –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏. 

UpdateCarModel - –∫–ª–∞—Å—Å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ Car.  

Optional –≤ —Å—Ç—Ä–æ–∫–µ color: Optional[str] –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ. 

ResponseModel - –º–æ–¥–µ–ª—å, –∫–∞–∫ –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å, –≤ –Ω–µ–º —É–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ, –∫–æ–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.

ErrorResponseModel - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å –æ—à–∏–±–∫–æ–π.

### –ù–∞—Å—Ç—Ä–æ–∏–º Motor

Motor - —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä MongoDB –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

–ï–≥–æ –º—ã —Å–∫–∞—á–∞–ª–∏, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–í —Ñ–∞–π–ª app/server/database.py –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–¥, –≥–¥–µ –º—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ—Ç–æ—Ä, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫ –º—ã –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ë–î. 

```python
import motor.motor_asyncio
from bson.objectid import ObjectId
from decouple import config

MONGO_DETAILS = "mongodb://localhost:27017"

client = motor.motor_asyncio.AsyncIOMotorClient(MONGO_DETAILS)

database = client.cars

car_collection = database.get_collection("car_collection")
```

–ó–¥–µ—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è client - –æ–±—ä–µ–∫—Ç –¥—Ä–∞–π–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î. –í database –º—ã –∑–∞–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞ –≤ car_collection —Å–æ–∑–¥–∞–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏—é, —ç—Ç–æ –∞–Ω–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î.  –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–µ—Ä–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∫–∞–∫ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–π—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–∞—Ä—Å–∏–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª–æ–≤–∞—Ä—å Python.

–í —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ –Ω–∏–∂–µ –¥–æ–±–∞–≤—å:

```python
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–¥ –≤ —Å–ª–æ–≤–∞—Ä—å
def car_helper(car) -> dict:
    return {
        "id": str(car["_id"]),
        "brand": car["brand"],
        "series": car["series"],
        "color": car["color"],
        "year_of_release": car["year_of_release"]
    }
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î.

```python
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
async def retrieve_cars():
    cars = []
    async for car in car_collection.find():
        cars.append(car_helper(car))
    return cars

# –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
async def add_car(car_data: dict) -> dict:
    car = await car_collection.insert_one(car_data)
    new_car = await car_collection.find_one({"_id": car.inserted_id})
    return car_helper(new_car)

# –ü–æ–ª—É—á–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º ID
async def retrieve_car(id: str) -> dict:
    car = await car_collection.find_one({"_id": ObjectId(id)})
    if car:
        return car_helper(car)

# –û–±–Ω–æ–≤–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å —Å –ø–æ–º–æ—â—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ ID
async def update_car(id: str, data: dict):
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ false, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—É—Å—Ç–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞.
    if len(data) < 1:
        return False
    car = await car_collection.find_one({"_id": ObjectId(id)})
    if car:
        updated_car = await car_collection.update_one(
            {"_id": ObjectId(id)}, {"$set": data}
        )
        if updated_car:
            return True
        return False

# –£–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ ID
async def delete_car(id: str):
    car = await car_collection.find_one({"_id": ObjectId(id)})
    if car:
        await car_collection.delete_one({"_id": ObjectId(id)})
        return True
```

–í –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –≤—ã—à–µ –∫–æ–¥–µ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —á—Ç–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –¥–≤–∏–≥–∞—Ç–µ–ª—è.

### Routers

–ß—Ç–æ —Ç–∞–∫–æ–µ Route?

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä:

```
https://ru.hexlet.io/code_reviews/4172
https://ru.hexlet.io/courses/programming-basics
https://ru.hexlet.io/account/profile/edit
```

–ö–∞–∂–¥—ã–π –∞–¥—Ä–µ—Å –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (Route). –ü—Ä–∏—á—ë–º –∏—Ö –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ —Ç–∏–ø—É: —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ. –ü–µ—Ä–≤—ã–π –º–∞—Ä—à—Ä—É—Ç - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π, —Ç.–∫. id –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ.

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –¥–æ–±–∞–≤–∏–º –º–∞—Ä—à—Ä—É—Ç—ã –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

–í —Ñ–∞–π–ª–µ routes/car.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–æ–¥–µ–ª–∏ –∏ —Å–æ–∑–¥–∞–¥–∏–º —Ä–æ—É—Ç–µ—Ä

```
from fastapi import APIRouter, Body
from fastapi.encoders import jsonable_encoder

from app.server.database import (
    add_car,
    delete_car,
    retrieve_car,
    retrieve_cars, update_car
)
from app.server.models.car import (
    ErrorResponseModel,
    ResponseModel,
    CarSchema,
    UpdateCarModel,
)

router = APIRouter()
```

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON Compatible Encoder –æ—Ç FastAPI –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å JSON.

–ó–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –≤ app/server/app.py:

```python
app.include_router(CarRouter, tags=["Car"], prefix="/car")
```

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Ñ–∞–π–ª app/server/app.py –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç —Ç–∞–∫:

```python
from fastapi import FastAPI

from app.server.routes.car import router as CarRouter

app = FastAPI()

app.include_router(CarRouter, tags=["Car"], prefix="/car")

@app.get("/", tags=["Root"])
async def read_root():
    return {"message": "Welcome to app!"}
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MongoDB Atlas

–°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –≤ Mongo Atlass. –ß—Ç–æ–±—ã –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å —Å—Å—ã–ª–∫—É(–ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –µ–µ –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ), –∑–∞–≤–µ–¥–µ–º —Ñ–∞–π–ª .env –∏ –ø–æ–ª–æ–∂–∏–º —Å—Å—ã–ª–∫—É —Ç—É–¥–∞. 

![Untitled](images/Untitled%208.png)

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ñ–∞–π–ª app/server/database.py 

```python
–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º:
from decouple import config

–ú–µ–Ω—è–µ–º —Å—Ç—Ä–æ–∫—É 
MONGO_DETAILS = "mongodb://localhost:27017"
–Ω–∞
MONGO_DETAILS = config('MONGO_DETAILS') # read environment variable.
MONGO_DETAILS = MONGO_DETAILS
```

–ú—ã –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ –ë–î –∏ –Ω–∞–º –æ—Å—Ç–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã —Ç–µ—Å—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

–í–≤–æ–¥–∏–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª:

```python
uvicorn app.server.app:app --reload
```

–í—Å–µ! 

–ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–µ—Ä–≤–µ—Ä –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ Swagger –ø–æ –∞–¥—Ä–µ—Å—É [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs).

–ó–¥–µ—Å—å –Ω–∞—à —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å–∞–º –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –Ω–∞—à–∏–º —ç–Ω–¥–ø–æ–∏—Ç–Ω–∞–º –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏–º –∑–∞–ø—Ä–æ—Å—ã. 

–ï—Å–ª–∏ —Ç—ã –Ω–µ –∑–Ω–∞–µ—à—å –æ —Ç–∏–ø–∞—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤, —Ç–æ –µ—Å—Ç—å –µ—Å—Ç—å –¥–≤–∞ —Å–∞–º—ã—Ö —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö - GET, POST. –†–∞–∑–Ω–∏—Ü–∞ –≤ —Ç–æ–º, —á—Ç–æ –≤ POST –µ—Å—Ç—å —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î. –í GET-–∑–∞–ø—Ä–æ—Å–µ –º—ã –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —Ç–æ –µ—Å—Ç—å –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–ø—Ä–æ—Å –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤. 

–í—ã–±–∏—Ä–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ: 

![Untitled](images/Untitled%209.png)

–ù–∞–∂–∏–º–∞–µ–º Try it out –∏ –≤–≤–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ, –∫–∞–∫–∏–µ —Ö–æ—Ç–∏—Ç–µ, –∑–∞—Ç–µ–º Execute. –ï—Å–ª–∏ Code Response == 200, –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ. 

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –ë–î.

–í—ã–±–µ—Ä–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞—à–∏–Ω:

![Untitled](images/Untitled%2010.png)

–ù–∞–∂–∏–º–∞–µ–º Try it out –∏ Execute.

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è —Ç–æ, —á—Ç–æ –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–ª–æ–∂–∏–ª–∏ –≤ –±–¥.

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ.

![Untitled](images/Untitled%2011.png)

–ù–∞ —ç—Ç–æ–º —Å –±—ç–∫–æ–º –≤—Å–µ! –¢–∞–∫ –º—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ 2.